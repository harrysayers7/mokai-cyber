// This is your Prisma schema file
// Government-grade simple: Just what you need for Essential Eight tracking

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Organization {
  id        String    @id @default(cuid())
  name      String
  abn       String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  
  controls  Control[]
  auditLogs AuditLog[]
  
  @@map("organizations")
}

model Control {
  id             String   @id @default(cuid())
  organizationId String
  controlId      String   // e.g., 'app-control', 'patch-apps'
  maturityLevel  Int      @default(0) // 0-3 as per Essential Eight
  evidence       String?  @db.Text
  lastUpdated    DateTime @default(now())
  nextReview     DateTime
  
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  
  @@unique([organizationId, controlId])
  @@map("controls")
}

model AuditLog {
  id             String   @id @default(cuid())
  organizationId String
  userId         String?  // Will connect to Clerk later
  action         String   // e.g., 'control.update', 'report.generated'
  details        Json?    // Store any relevant data
  ipAddress      String?
  createdAt      DateTime @default(now())
  
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  
  @@index([organizationId, createdAt])
  @@map("audit_logs")
}